name: Restore Deleted File

on:
  workflow_dispatch:  # 手动触发
  push:
    branches: [ main ]

jobs:
  restore-file:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # 拉取完整历史记录
          persist-credentials: true  # 保留推送权限

      - name: Restore providers.json
        run: |
          # 从历史提交中恢复文件（注意替换为实际路径）
          git checkout f98e01afcd -- sing-box-sub/providers.json
          # 检查文件是否存在
          if [ ! -f "sing-box-sub/providers.json" ]; then
            echo "❌ 文件恢复失败，路径可能错误！"
            exit 1
          fi

      - name: Commit and Push
        run: |
          # 配置Git用户信息
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

          # 拉取远程最新代码并合并（关键修复点）
          git pull origin main --rebase  # 使用 rebase 避免合并冲突

          # 提交并推送
          git add sing-box-sub/providers.json
          git commit -m "chore: 从提交 f98e01a 恢复 providers.json"
          git push origin main
